## Commands
This section lists commands run by gridss workflow

* Running GRIDSS

perform joint SV calling on the tumour and normal. The workflow consists of three steps
described below:


## SV_PREP script runs on inputs before preprocessing and assembly steps

```
    set -euo pipefail
    mkdir WORKING_DIR

    SVPREP_SCRIPT  \
      -sample INPUT_NAME \
      -bam_file INPUT_BAM \
      -output_dir WORKING_DIR \
      -ref_genome REF_FASTA \
      -ref_genome_version FASTA_VERSION \
      -blacklist_bed BLOCKLIST \
      -known_fusion_bed KNOWN_FUSIONS \
      -existing_junction_file JUNCTIONS \ [Optional]
      -partition_size PARTITIONS \
      -apply_downsampling

   samtools sort -T WORKING_DIR --reference REF_FASTA WORKING_DIR/INPUT_NAME.sv_prep.bam -o WORKING_DIR/INPUT_NAME.sv_prep.sorted.bam
   rm WORKING_DIR/INPUT_NAME.sv_prep.bam
  
```
## Preprocessing 

```
   GRIDSS_SCRIPT
   -b BLACKLIST \
   -r REF_FASTA \
   -s preprocess \
   -t THREADS \
   INPUT_BAM
```

## Assembly

Assembly is performed in parallel on 10Mbase chunks. This step scales to 8 cores with peak memory usage of 31Gb
and can be distributed across multiple nodes (using scatter)

```
    set -euo pipefail
    mkdir WORKDIR_NORM WORKDIR_TUMOR
    ln -s PROCESSED_NORMBAM WORKDIR_NORM/basename(NORMBAM).sv.bam
    ln -s PROCESSED_NORMIDX WORKDIR_NORM/basename(NORMBAM).sv.bam.csi
    ln -s PROCESSED_TUMRBAM WORKDIR_TUMOR/basename(TUMRBAM).sv.bam
    ln -s PROCESSED_TUMRIDX WORKDIR_TUMOR/basename(TUMRBAM).sv.bam.csi

    GRIDSS_SCRIPT
    -b BLACKLIST \
    -r REF_FASTA \
    -t THREADS \
    -s assemble \
    -a assembly.bam \
    --jobnodes JOB_NODES \
    --jobindex JOB_INDEX \
    NORM_BAM TUMOR_BAM
```

## Call SVs

Using pre-processed data call Structural Variants

```
    set -euo pipefail
    mkdir WORKDIR_NORM WORKDIR_TUMOR
    ln -s PROCESSED_NORMBAM WORKDIR_NORM/basename(NORMBAM).sv.bam
    ln -s PROCESSED_NORMIDX WORKDIR_NORM/basename(NORMBAM).sv.bam.csi
    ln -s PROCESSED_TUMRBAM WORKDIR_TUMOR/basename(TUMRBAM).sv.bam
    ln -s PROCESSED_TUMRIDX WORKDIR_TUMOR/basename(TUMRBAM).sv.bam.csi
    mkdir assembly.bam.gridss.working
    
    for f in ~{sep=' ' assembleChunks}
    do
      ln -s $f -t assembly.bam.gridss.working
    done

    GRIDSS_SCRIPT
    -b BLACKLIST \
    --jvmheap (MEMORY - OVERHEAD)g \
    --otherjvmheap OVERHEADg \
    --reference REF_FASTA \
    -a assembly.bam \
    -s assemble,call \
    -t THREADS \
    -o OUTPUT_PREFIX.allocated.vcf \
    NORM_BAM TUMOR_BAM
```
